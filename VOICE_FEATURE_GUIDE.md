# 语音功能使用指南

## 功能概述

本旅游规划应用已集成语音输入功能，允许用户通过语音输入旅游需求，系统会自动将语音转换为文字并填充到表单中。

## 语音服务说明

### 当前实现方案
由于科大讯飞API在Web端需要HTTPS和复杂的认证流程，当前采用**浏览器原生语音识别API**实现，具有以下优势：
- 无需网络请求，响应速度快
- 完全本地处理，保护用户隐私
- 支持主流现代浏览器
- 零配置，开箱即用

### 浏览器兼容性
- ✅ **Chrome** (版本 25+)
- ✅ **Edge** (版本 79+)
- ✅ **Safari** (版本 14.1+)
- ❌ Firefox (暂不支持)
- ❌ 移动端浏览器 (支持情况不一)

## 使用方法

### 1. 在旅游计划创建页面

1. **导航到计划创建页面**
   - 进入应用后点击"智能行程规划"
   - 或直接访问 `/plan` 路由

2. **找到语音输入区域**
   - 在表单中找到"特殊需求"字段
   - 该字段下方有语音控制按钮

3. **使用语音输入**
   - 点击"语音输入"按钮开始录音
   - 按钮变为红色并显示"停止录音"
   - 清晰地说出您的旅游需求
   - 实时识别结果会显示在按钮下方
   - 点击"停止录音"结束语音识别

### 2. 语音输入最佳实践

- **环境要求**
  - 确保在安静的环境中使用
  - 距离麦克风适当距离（约30-50厘米）
  - 避免背景噪音干扰

- **说话技巧**
  - 语速适中，清晰发音
  - 使用完整的句子表达需求
  - 示例："我想去日本东京旅游，时间5天，预算5000元，喜欢美食和购物"

- **内容建议**
  - 目的地和旅行时间
  - 预算和人数限制
  - 兴趣爱好和偏好
  - 特殊需求（饮食、住宿等）

## 技术实现细节

### 核心组件

1. **语音识别服务** (`src/lib/xunfei-speech-service.ts`)
   - 封装浏览器SpeechRecognition API
   - 提供开始/停止录音功能
   - 处理实时语音转文字
   - 错误处理和状态管理

2. **Vue组件集成** (`src/views/plan/index.vue`)
   - 在特殊需求字段添加语音控制
   - 实时显示识别结果
   - 自动填充到表单字段
   - 支持组件状态管理

### 功能特性

- ✅ **实时语音识别** - 边说边识别，实时显示结果
- ✅ **连续录音** - 支持长时间连续录音
- ✅ **自动填充** - 识别结果自动填入表单
- ✅ **状态指示** - 清晰显示录音状态
- ✅ **错误处理** - 完善的错误提示和恢复机制
- ✅ **浏览器兼容性检测** - 自动检测浏览器支持情况

## 测试和调试

### 1. 测试页面
提供了一个独立的测试页面：`/src/views/plan/speech-test.html`

可以直接在浏览器中打开该文件进行语音功能测试：

```bash
# 在项目根目录执行
open src/views/plan/speech-test.html
```

### 2. 浏览器权限
首次使用时，浏览器会请求麦克风权限：
- 点击"允许"授权麦克风访问
- 如果误操作，可以通过浏览器设置重新授权

### 3. 常见问题排查

**问题1：无法开始录音**
- 检查浏览器是否支持语音识别
- 确认已授权麦克风访问
- 查看浏览器控制台错误信息

**问题2：识别准确率低**
- 确保环境安静
- 调整麦克风位置和音量
- 说话时口齿清晰，语速适中

**问题3：识别结果延迟**
- 检查网络连接（如果使用云端API）
- 关闭其他占用麦克风的程序
- 刷新页面重试

## 未来扩展计划

### 科大讯飞API集成（可选）
如果需要更高质量的语音识别，可以集成科大讯飞API：

1. **环境配置**
```env
VITE_XUNFEI_APP_ID=72132a16
VITE_XUNFEI_API_KEY=bb06fe8fd7ee268cfe517b7becaab3c8
VITE_XUNFEI_API_SECRET=ZTVhMjk2ZmUxOGEyZDgyNzk4MjMwNjgx
```

2. **WebSocket连接**
- 建立实时语音识别连接
- 处理音频流数据
- 集成到现有语音服务中

### 功能增强
- 📍 **语音命令** - 支持语音导航和操作
- 🌍 **多语言支持** - 支持多种语言的语音输入
- 🎯 **智能提示** - 基于语音输入的智能建议
- 📱 **移动端优化** - 针对移动设备的语音输入体验

## 开发说明

### 代码结构
```
src/
├── lib/
│   └── xunfei-speech-service.ts  # 语音识别服务
└── views/
    └── plan/
        ├── index.vue             # 主页面组件
        └── speech-test.html       # 测试页面
```

### 核心API
```typescript
// 语音识别服务
class XunfeiSpeechService {
  startRecognition(options): Promise<void>
  stopRecognition(): void
  isSupported(): boolean
  getFinalText(): string
}

// Vue组件中使用
const { speechLoading, isRecording, speechText, speechSupported } = useSpeech()
```

## 总结

语音输入功能为用户提供了更便捷的旅游需求输入方式，大大提升了用户体验。当前实现基于浏览器原生API，具有零配置、快速响应的优势，适合大多数使用场景。

如有特殊需求或需要更高质量的语音识别，可以考虑集成科大讯飞等专业语音服务商的API。